<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS App</title>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.0/dist/cdn.min.js"></script>
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-50 text-gray-800" x-data="app()" x-init="init()">

  <!-- HEADER -->
  <header class="flex items-center justify-between px-4 py-1 bg-white border-b shadow-sm">
    <div class="flex items-center space-x-3">
      <button @click="navigate('home')">
        <img src="assets/icons/home.svg" class="w-5 h-5" alt="home icon" />
      </button>
      <div class="relative">
        <span class="absolute inset-y-0 left-2 flex items-center text-gray-400">
          <img src="assets/icons/iconSearch.png" class="w-5 h-5" alt="Search icon" />
        </span>
        <input type="text" placeholder="Search Chair, Table, Etc..."
          class="w-72 pl-8 pr-4 py-1.5 rounded-md border border-gray-300 text-sm focus:outline-none focus:ring-1 focus:ring-blue-400"
          x-model="searchTerm" @input.debounce.300ms="handleSearchInput"/>
      </div>
    </div>
<button @click="cartOpen = !cartOpen" class="relative">
  <img src="assets/icons/shopping-cart.svg" class="w-5 h-5" />
  <span
    x-show="cart.length > 0"
    class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-1"
    x-text="cart.length"
  ></span>
</button>

  </header>

  <!-- TOAST -->
<div
  x-show="toast.show"
  x-transition
  class="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow z-50"
  x-text="toast.message"
></div>

<div
  x-show="cartOpen"
  @click="cartOpen = false"
  x-transition.opacity
  class="fixed inset-0 bg-black/50 z-60"
></div>

<!-- SIDEBAR -->
<aside
  x-show="cartOpen"
  x-transition:enter="transition ease-out duration-300"
  x-transition:enter-start="translate-x-full"
  x-transition:enter-end="translate-x-0"
  x-transition:leave="transition ease-in duration-300"
  x-transition:leave-start="translate-x-0"
  x-transition:leave-end="translate-x-full"
  class="fixed top-0 right-0 w-96 h-full bg-white shadow-lg z-50 overflow-y-auto"
>
  <div class="p-6">
    <div class="flex justify-between items-center">
      <h2 class="text-xl font-semibold">Order Details</h2>
      <button class="text-yellow-500 text-sm" @click="cart = []">Clear Cart</button>
    </div>
    <div class="mt-4 space-y-4">
      <template x-for="item in cart" :key="item.id">
        <div class="flex items-center justify-between border-b pb-2">
          <div class="flex items-center gap-2 w-1/3">
            <img src="assets/img/office-chair.jpg" class="w-10 h-10 object-contain" />
            <span class="text-sm" x-text="item.name"></span>
          </div>
          <div class="flex items-center gap-2 w-1/3">
            <button class="px-2" @click="item.qty = Math.max(1, item.qty - 1)">-</button>
            <span x-text="item.qty"></span>
            <button class="px-2" @click="item.qty++">+</button>
          </div>
          <div class="flex items-center gap-2 w-1/3 justify-end">
            <span class="w-12 text-right text-sm" x-text="'$' + (item.price * item.qty)"></span>
            <button class="text-red-500" @click="removeFromCart(item.id)">üóë</button>
          </div>
        </div>
      </template>
    </div>

    <!-- SUMMARY -->
    <div class="mt-6 text-sm">
      <div class="flex justify-between"><span>Sub Total :</span><span x-text="'$' + totalPrice"></span></div>
      <div class="flex justify-between"><span>Product Discount :</span><span>$0</span></div>
      <div class="flex justify-between font-bold text-lg mt-2">
        <span>Total :</span><span x-text="'$' + totalPrice"></span>
      </div>
    </div>

    <!-- PAYMENT METHOD -->
    <div class="mt-6">
      <h3 class="text-sm font-semibold mb-2">Payment Method</h3>
      <div class="flex gap-4">
        <button class="flex-1 p-2 border rounded text-sm">Cash</button>
        <button class="flex-1 p-2 border rounded text-sm">Cart</button>
        <button class="flex-1 p-2 border rounded text-sm">E-Wallet</button>
      </div>
      <button class="mt-6 w-full bg-yellow-600 text-white py-2 rounded text-sm">Order Now</button>
    </div>
  </div>
</aside>

  <!-- MAIN CONTENT -->
  <main id="page-content" class="px-3 py-1"></main>

  <!-- JS -->
  <script>
    function app() {
  return {
    cart: [],
    cartOpen: false,
    toast: { show: false, message: '' },
    categories: [
      { id: 1, name: "Living Room", image: "assets/img/living-room.png" },
      { id: 2, name: "Bedroom", image: "assets/img/bedroom.png" },
      { id: 3, name: "Dining Room", image: "assets/img/dinning-room.png" },
      { id: 4, name: "Office", image: "assets/img/office.png" },
      { id: 5, name: "Kitchen", image: "assets/img/kitchen.png" },
      { id: 6, name: "Outdoor", image: "assets/img/outdoor.png" },
      { id: 7, name: "Decoration", image: "assets/img/decoration.png" },
      { id: 8, name: "Kids", image: "assets/img/kids.png" }
    ],
    products: [],
    searchTerm: '',
    currentPage: 'home',
    lastPageBeforeSearch: 'home', // ‚¨ÖÔ∏è Tambahan ini

    async init() {
      try {
        const res = await window.__TAURI__.core.invoke("get_products");
        this.products = JSON.parse(res);
      } catch (e) {
        console.error("Gagal ambil produk:", e);
      }
      this.navigate('home');
    },

    removeFromCart(id) {
      this.cart = this.cart.filter(item => item.id !== id);
    },
    async navigate(page) {
      const el = document.getElementById('page-content');
      if (!el) return;
      el.innerHTML = '<div class="text-center py-10">Loading...</div>';
      try {
        const res = await fetch(`pages/${page}.html`);
        const html = await res.text();
        el.innerHTML = html;
        this.currentPage = page; // ‚¨ÖÔ∏è Update halaman aktif
        Alpine.initTree(el);
      } catch (err) {
        el.innerHTML = '<div class="text-red-500 text-center py-10">Gagal load halaman</div>';
        console.error("Error loading page:", err);
      }
    },

handleSearchInput() {
  const term = this.searchTerm.trim();

  if (term !== '') {
    // Kalau bukan di halaman all-product, berarti user search dari luar
    if (this.currentPage !== 'all-product') {
      this.lastPageBeforeSearch = this.currentPage;
      this.navigate('all-product');
    }
    // Kalau udah di all-product, biarkan filter jalan otomatis
  } else {
    // Kalau kosong dan sebelumnya user datang dari luar all-product
    if (
      this.currentPage === 'all-product' &&
      this.lastPageBeforeSearch &&
      this.lastPageBeforeSearch !== 'all-product'
    ) {
      this.navigate(this.lastPageBeforeSearch);
      this.lastPageBeforeSearch = null; // reset biar gak nyangkut
    }
    // Kalau asalnya dari all-product juga, ya diem aja
  }
}

,

addToCart(product) {
  const existing = this.cart.find(i => i.id === product.id);
  if (existing) existing.qty++;
  else this.cart.push({ ...product, qty: 1 });

  this.toast.message = `${product.name} added to cart`;
  this.toast.show = true;
  setTimeout(() => this.toast.show = false, 2000);
},

    get filteredProducts() {
      return this.products.filter(p =>
        p.name.toLowerCase().includes(this.searchTerm.toLowerCase())
      );
    },

    get totalPrice() {
      return this.cart.reduce((t, i) => t + i.price * i.qty, 0);
    }
  }
}
  </script>

</body>
</html>
